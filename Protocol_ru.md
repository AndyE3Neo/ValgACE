# Протокол взаимодействия с Anycubic ACE Pro

## Транспортный уровень

- Связь через USB CDC **без контроля потока** и проверки целостности данных
- Общий кольцевой буфер для ввода/вывода (риск потери данных при высокой нагрузке)
- **Критические ограничения**:
  - Макс. безопасный размер данных: 1024 байта (может измениться)
  - Необходимо дожидаться ответа перед новой отправкой
  - Переполнение буфера вызывает потерю данных

## Формат кадров

### Структура кадра
```hex
0xFF 0xAA                  // Заголовок
[2 байта LE - длина данных]
[JSON-данные]
[2 байта CRC-16/MCRF4XX LE]
0xFE                       // Завершающий байт

## Особенности работы
- Таймаут 3 секунды: Разрыв соединения при неполной передаче кадра

## Риски повреждения:

- Коррупция заголовка (0xFF 0xAA) может вызывать зависания

- CRC не должен совпадать с 0xFFAA (little-endian)

- Критическая ошибка: Кадры >1024 байт блокируют устройство

### RPC-протокол
## ВНИМАНИЕ: Непроверенная реализация - используйте с осторожностью

Структура запроса
{
  "id": <номер_сообщения>,
  "method": "<имя_метода>",
  "params": { /* параметры */ }
}

Структура ответа
{
  "id": <id_запроса>,
  "result": { /* данные */ },
  "code": <код_статуса>,
  "msg": "<статус>"
}
## Важные замечания:

- Требуется потокобезопасная работа с соединением

- Обязательный механизм keep-alive (рекомендуется 1с)

- Блокировка порта при выполнении запросов

## Справочник методов
Основные методы
- Метод	          Параметры	            Ответ
- enable_rfid	       Нет        	        code: 0, msg: "success"
- disable_rfid	   Нет	                code: 0, msg: "success"
- get_info	       Нет	                Метаданные устройства
- get_filament_info  index (номер слота)	Характеристики филамента
- get_status	       Нет	                Статус системы

## Управление филаментом
#### `feed_filament`
- **Параметры**:
  - `index`: Номер слота
  - `length`: Длина подачи (мм)
  - `speed`: Скорость (мм/с)

#### `unwind_filament`
- **Параметры**:
  - `index`: Номер слота
  - `length`: Длина отмотки (мм)
  - `speed`: Скорость (мм/с)
  - `mode`: 0=обычный, 1=усиленный

## Управление сушкой
#### `drying`
- **Параметры**:
  - `temp`: Температура (°C)
  - `fan_speed`: Обороты (по умолч. 7000)
  - `duration`: Время (мин, макс 240)

#### `drying_stop`
- Мгновенная остановка сушки

### Структуры данных
{
  "min": <int>,  // Минимум (°C)
  "max": <int"   // Максимум (°C)
}

### Статус слота
{
  "index": <int>,          // Номер слота
  "status": "<статус>",    // "ready"/"busy"
  "sku": "<идентификатор>",// ID материала
  "rfid": <код_статуса>    // 0-3 (см. док.)
}

## ВАЖНО: Документация основана на реверс-инжиниринге. Не является официальной. Протокол может изменяться с обновлениями прошивки.