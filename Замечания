ороче высокоуровнево:
- Почитай модули клиппера, модули I2C датчиков хороший пример, они "простые"
- Нарезать строку по префиксу не круто, в клиппоре в "каждом" модуле это есть и достаточно делать .split()
- Блокировка для потоков - круто, не круто что ты её присваешь (она не работает), ты хочешь делать with self.lock:
- Ты не хочешь собственные логи, логи клиппера уже оукей, тебе достаточно просто делать import logging, и собственно logging.info
Клиппер с ними работает сильно ниже по коду и вообще вкручивать общение в пистон не оч круто
Но если на железку нельзя воткнуть Klipper, то бог с ним, играйся
Поток для чтения/записи это хорошо, не уверен насколько имеет смысл иметь 2 потока откровенно говоря, но ок

А да, sleep это не оч круто.
По крайней мере в коде модуля, который крутится в реакторе, ты не хочешь делать time.sleep() - никогда
Ты хочешь делать self.reactor.pause(eventime + 0.01) - это вместо слипа, но реактор будет делать что-то полезное, а не вешать клиппер
При правильной блокировке sleep не нужен, это mutex
Это значит что поток который ждёт блокировку вешается.

Ты не хочешь вешаться в основном потоке исполнения клиппера.
(я не проверял весь код, мб ты этого не делаешь в основном потоке)

В тредах, напротив, ты можешь делать что захочешь, это твои треды и твой код внутри крутитсо